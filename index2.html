<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DDJ-FLX6-GT – Web MIDI Logger</title>
  <meta name="description" content="Log every MIDI message from your controller. Host on GitHub Pages.">
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div class="wrap">
    <header>
      <h1>DDJ-FLX6-GT • Web MIDI Logger & Mapper</h1>
      <div class="row">
        <span class="pill"><span class="dot bad" id="connDot"></span><span id="connText">MIDI not connected</span></span>
      </div>
    </header>

    <div class="grid">
      <!-- LEFT: Controls + Log + Mapper -->
      <section class="card split">
        <div class="controls">
          <label for="inputSel">Input:</label>
          <select id="inputSel"></select>

          <label for="outputSel">Output:</label>
          <select id="outputSel"></select>

          <button id="reqBtn">Request MIDI</button>
          <button id="clearBtn" class="ghost">Clear Log</button>
          <button id="dlBtn" title="Download CSV">Export CSV</button>
          <button id="saveMapBtn" class="ghost">Save Map</button>
          <button id="dlMapBtn" class="ghost">Export Map JSON</button>
        </div>
        <div class="row">
          <label><input type="checkbox" id="wantSysex"> request SysEx</label>
          <label><input type="checkbox" id="showHex" checked> show hex</label>
          <label><input type="checkbox" id="timestamps" checked> timestamps</label>
          <label><input type="checkbox" id="autoscroll" checked> autoscroll</label>
        </div>

        <div class="card card--inner">
          <div class="row row--between">
            <strong>Live Log</strong>
            <span class="tiny">Tips: Move a knob, press a pad, nudge jogs. If nothing shows, that control may be HID-only.</span>
          </div>
          <div class="logwrap" id="logWrap">
            <table id="logTbl">
              <thead>
                <tr>
                  <th class="nowrap">#</th>
                  <th class="nowrap">Time</th>
                  <th>Device</th>
                  <th>Type</th>
                  <th>Ch</th>
                  <th>Data</th>
                  <th>Raw</th>
                </tr>
              </thead>
              <tbody id="logBody"></tbody>
            </table>
          </div>
        </div>

        <div class="card card--inner">
          <div class="row row--between">
            <strong>Learn / Map controls</strong>
            <span class="tiny">Start learning → move a control → name it → Add Mapping → Save/Export.</span>
          </div>
          <div class="learn">
            <button id="learnBtn">Start learning</button>
            <input class="name" id="mapName" placeholder="name this control (e.g. CH1_FADER)">
            <button id="addMapBtn" class="ghost">Add Mapping</button>
            <span class="hint" id="lastMsg">Waiting…</span>
          </div>
          <div class="maplist" id="mapList"></div>
        </div>
      </section>

      <!-- RIGHT: Activity LEDs + CC Bars + Notes -->
      <aside class="card vis">
        <div>
          <strong>Channel Activity</strong>
          <div class="leds" id="chanLeds"></div>
        </div>
        <div>
          <strong>CC Levels (0-127)</strong>
          <div class="bars" id="ccBars"></div>
        </div>
        <div>
          <strong>Notes (on/off)</strong>
          <div class="leds" id="noteLeds"></div>
          <div class="tiny" style="margin-top:6px">Shows notes 0–127 in windows of 16. Use ←/→ to change range.</div>
        </div>
      </aside>
    </div>

    <footer>
      Works best in Chrome/Edge over HTTPS (GitHub Pages). Safari has limited Web MIDI. Some FLX6-GT controls are HID (not MIDI).
      <br>Single-page, no build. Push and go.
    </footer>
  </div>

  <script type="module" src="./src/main.js"></script>
</body>
</html>
